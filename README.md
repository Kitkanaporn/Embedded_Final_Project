# Embedded_Fianl_Project // ระบบตรวจจับสิ่งของในตู้และรักษาความปลอดภัยด้วยเสียง + IoT (ESP32)

โปรเจกต์นี้เป็นระบบตรวจสอบสิ่งของภายในตู้เก็บของ พร้อมฟังก์ชันรักษาความปลอดภัยเบื้องต้น โดยมีความสามารถหลักสองส่วน:

1. **ตรวจว่าในตู้มีสิ่งของครบหรือไม่**  
   - ใช้เซนเซอร์ตรวจจับวัตถุ (เช่น IR / Ultrasonic / Sensor ลำแสง)  
   - ถ้าไม่พบสิ่งของในตำแหน่งที่กำหนด จะมีการแจ้งเตือน (Alarm)

2. **ตรวจจับคน/การแอบเข้ามาใกล้ตู้ด้วยเสียงรบกวน**  
   - ใช้ไมโครโฟนตรวจจับระดับเสียงรอบ ๆ ตู้  
   - ถ้าระดับเสียงเกินค่าที่กำหนด (threshold) จะถือว่าผิดปกติ  
   - ระบบจะทำการแจ้งเตือนผ่าน IoT โดยใช้บอร์ด **ESP32**

ระบบนี้ออกแบบมาเพื่อใช้กับตู้เก็บของ / ตู้เก็บอุปกรณ์ / ตู้สินค้าหรือชั้นเก็บของ ที่ต้องการตรวจสอบว่า  
- มีของหายหรือไม่  
- มีคนพยายามเข้ามายุ่งกับตู้หรือไม่

---

## 1. วัตถุประสงค์ของโปรเจกต์

- เพื่อพัฒนาระบบ Embedded ที่สามารถ:
  - อ่านค่าจากเซนเซอร์หลายชนิด (ตรวจจับวัตถุ + ตรวจจับเสียง)
  - ประมวลผลเงื่อนไขและตัดสินใจ (มีของ/ไม่มีของ, เสียงปกติ/เสียงผิดปกติ)
  - แจ้งเตือนผู้ใช้งานแบบเรียลไทม์ผ่านเครือข่าย (IoT)

- เพื่อฝึกการใช้งานบอร์ด **ESP32** ร่วมกับ:
  - เซนเซอร์ตรวจจับวัตถุ <Obstacle avoidance sensor module>
  - ไมโครโฟน/เซนเซอร์เสียง <Microphone sound sensor module >
  - โมดูลแจ้งเตือน <Active buzzer module> <IoT - ESP32>

---

## 2. ภาพรวมการทำงานของระบบ (System Overview)

ระบบแบ่งการทำงานหลักออกเป็น 2 โหมด:

### 2.1 ตรวจจับสิ่งของในตู้ (Object Detection)

- ในแต่ละช่อง / ตำแหน่งของตู้จะมีเซนเซอร์ตรวจจับวัตถุ
  - ถ้าเซนเซอร์ "เจอ" สิ่งของ → สถานะปกติ
  - ถ้าเซนเซอร์ "ไม่เจอ" สิ่งของ (ของหาย หรือ ถูกหยิบออกไป) → ระบบจะ:
    - เปิดเสียง Alarm (Buzzer)
    - แสดงสถานะแจ้งเตือน (เช่น LED สีแดงกระพริบ หรือข้อความบนหน้าจอ)
    - ส่งข้อมูลแจ้งเตือนผ่าน IoT (เช่น ส่งขึ้น Server / Line Notify / Web Dashboard ตามที่กำหนด)

### 2.2 ตรวจจับเสียงเพื่อความปลอดภัย (Sound-based Security)

- ใช้ไมโครโฟนวัดระดับเสียงรอบ ๆ ตู้เป็นระยะ ๆ
- ระบบจะมีค่า **Threshold** ของเสียงที่ถือว่าปกติ  

- ถ้าพบว่า:
  - ระดับเสียงสูงกว่าค่าที่กำหนดต่อเนื่องในช่วงเวลาหนึ่ง  
  - เช่น มีเสียงเคาะตู้ / เปิดปิดแรง ๆ / เสียงคนพูดใกล้ ๆ นานผิดปกติ  

  ระบบจะ:
  - แจ้งเตือนผ่าน IoT ด้วย ESP32 (เช่น ส่งข้อมูลขึ้น Cloud / แจ้งเตือนผู้ใช้บนมือถือ)
  - อาจเปิด Alarm ในพื้นที่ (เช่น Buzzer หรือไฟกระพริบ) เพื่อเตือนในจุดเกิดเหตุ

---

## 3. ฮาร์ดแวร์ที่ใช้ (Hardware)

ตัวอย่างอุปกรณ์ (สามารถแก้ให้ตรงกับของจริงได้):

- **ไมโครคอนโทรลเลอร์หลัก:**  
  - ESP32 (ใช้ทั้งประมวลผล และเชื่อมต่อ Wi-Fi ในตัวเดียว)

- **เซนเซอร์ตรวจจับสิ่งของในตู้:**
  - Obstacle avoidance sensor module <IR-08H>
    ใช้สำหรับตรวจว่ามีวัตถุอยู่ในตำแหน่งที่กำหนดหรือไม่

- **เซนเซอร์เสียง:**
  - Obstacle avoidance sensor module <Microphone Baoter 3296>
  - ใช้ในการวัด “ระดับเสียง” แล้วเทียบกับค่า Threshold

- **โมดูลแจ้งเตือนในพื้นที่:**
  - Buzzer (Active/Passive) <TMB12A05>
  - LED (แสดงสถานะ ปกติ/ผิดปกติ)

- **การเชื่อมต่อเครือข่าย (IoT):**
  - ใช้ Wi-Fi จาก ESP32 เชื่อมต่อกับ Router / Hotspot
  - ส่งข้อมูลไปยัง:
    - Line Notify

---

## 4. ซอฟต์แวร์และเครื่องมือ (Software & Tools)

- ภาษาโปรแกรม:  
  - C / C++ (ผ่าน Arduino IDE หรือ ESP-IDF)

- IDE / Environment:
  - Arduino IDE (ตั้งค่า Board เป็น ESP32)
  - หรือตามที่ใช้จริง เช่น PlatformIO

- Library ที่ใช้:
  - WiFi / HTTP / MQTT (สำหรับส่งข้อมูลขึ้น IoT)
  - ไลบรารีอ่านค่า ADC / debounce / timer ตามต้องการ

---

## 5. ลำดับการทำงานของโปรแกรม (Workflow)

1. **เริ่มต้นระบบ (Initialization)**
   - ตั้งค่า GPIO สำหรับเซนเซอร์, Buzzer, LED
   - ตั้งค่า ADC สำหรับอ่านไมโครโฟน
   - เชื่อมต่อ Wi-Fi (ถ้าเชื่อมต่อสำเร็จจะพร้อมส่งข้อมูลแจ้งเตือน)

2. **วนลูปหลัก (Main Loop)**
   - อ่านค่าจากเซนเซอร์ตรวจจับวัตถุในตู้ทุก ๆ ระยะเวลาหนึ่ง
     - ถ้าพบช่องที่ "ไม่เจอของ" → สถานะผิดปกติ
       - เปิด Alarm (เสียง/ไฟ)
       - ส่งข้อมูลแจ้งเตือนผ่าน IoT

   - อ่านค่าระดับเสียงจากไมโครโฟน (ผ่าน ADC)
     - คำนวณค่าเฉลี่ย / ค่า peak ในช่วงเวลาสั้น ๆ
     - เปรียบเทียบกับ Threshold ที่กำหนด
       - ถ้าสูงเกิน Threshold ติดต่อกันหลายครั้ง → ถือว่ามีเหตุผิดปกติ
         - ส่งข้อมูลแจ้งเตือนผ่าน IoT
         - (อาจเปิด Alarm เช่นเดียวกับกรณีของหาย)

3. **การจัดการ Error / ความผิดพลาด**
   - ถ้า Wi-Fi หลุด → พยายามเชื่อมใหม่เป็นระยะ
   - ถ้าอ่านค่าเซนเซอร์ไม่ได้ → ใช้ค่าล่าสุด / แจ้งเตือน Error

---

## 6. การใช้งาน (Usage)

1. ติดตั้งเซนเซอร์ในตู้เก็บของในตำแหน่งที่ต้องการตรวจสอบ
2. ต่อแหล่งจ่ายไฟให้ ESP32 และวงจรทั้งหมด
3. เปิดระบบ:
   - ระบบจะเริ่มมอนิเตอร์ทั้ง “การมีอยู่ของสิ่งของ” และ “ระดับเสียงรอบ ๆ ตู้”
4. เมื่อเกิดเหตุ:
   - สิ่งของหาย / ถูกหยิบออกจากช่อง → Alarm และแจ้งเตือน IoT
   - มีเสียงผิดปกติเกิน Threshold → แจ้งเตือนผ่าน IoT

---

<!--## 7. การต่อยอดในอนาคต (Future Work)

- แยกประเภทการแจ้งเตือน:
  - ของหาย / เสียงผิดปกติ / เปิดตู้บ่อยเกินไป ฯลฯ
- เพิ่มระบบล็อกตู้ (ใช้ Solenoid Lock) และควบคุมผ่าน ESP32
- เก็บ Log ทุกเหตุการณ์ลง Database หรือ Cloud
- ทำหน้า Web / แอปมือถือสำหรับดูสถานะตู้แบบเรียลไทม์

----->
